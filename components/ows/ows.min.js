define(["angular","map","ows.wms","ows.wmts","ows.wfs","ows.nonwms","ows.wmsprioritized","permalink"],function(angular){var e=angular.module("hs.ows",["hs.map","hs.ows.wms","hs.ows.wmts","hs.ows.nonwms","hs.ows.wmsprioritized"]).directive("hs.ows.directive",function(){return{templateUrl:hsl_path+"components/ows/partials/ows.html?bust="+gitsha}}).controller("hs.ows.controller",["$scope","$injector","hs.ows.wms.service_capabilities","hs.ows.wmts.service_capabilities","hs.map.service","hs.permalink.service_url","Core","hs.ows.nonwms.service","config","$rootScope",function(e,s,t,o,a,n,i,r,w,c){function l(e){i.setMainPanel("layermanager"),e.getSource().on("change",function(){var s=e.getSource().getExtent();null!=s&&m.getView().fit(s,m.getSize())})}var m=a.map;if(window.allowWFS2&&(srv_wfs_caps=s.get("hs.ows.wfs.service_capabilities")),angular.isArray(w.connectTypes)?e.types=w.connectTypes:e.types=["","WMS","KML","GeoJSON"],e.type="",e.image_formats=[],e.query_formats=[],e.tile_size=512,e.setUrlAndConnect=function(s,t){e.url=s,e.type=t,e.connect()},e.connect=function(){switch($(".ows-capabilities").slideDown(),e.type.toLowerCase()){case"wms":t.requestGetCapabilities(e.url),e.showDetails=!0;break;case"wmts":o.requestGetCapabilities(e.url),e.showDetails=!0;break;case"wfs":window.allowWFS2&&(srv_wfs_caps.requestGetCapabilities(e.url),e.showDetails=!0)}},e.templateByType=function(){var s,t=hsl_path+"components/ows/partials/";switch(e.type.toLowerCase()){case"wms":s=t+"owswms.html";break;case"wmts":s=t+"owswmts.html";break;case"wms with priorities":s=t+"owsprioritized.html";break;case"wfs":window.allowWFS2&&(s=t+"owswfs.html");break;case"kml":case"geojson":s=t+"owsnonwms.html",e.showDetails=!0}return s},e.isService=function(){return!(["kml","geojson","json"].indexOf(e.type.toLowerCase())>-1)},e.clear=function(){e.url="",$(".ows-capabilities").slideUp(),e.showDetails=!1},n.getParamValue("wms_to_connect")){var p=n.getParamValue("wms_to_connect");i.setMainPanel(i.singleDatasources?"datasource_selector":"ows"),e.setUrlAndConnect(p,"WMS"),c.$broadcast("ows.wms_connecting")}if(n.getParamValue("wfs_to_connect")&&window.allowWFS2){var u=n.getParamValue("wfs_to_connect");i.setMainPanel(i.singleDatasources?"datasource_selector":"ows"),e.setUrlAndConnect(u,"WFS"),i.singleDatasources&&$('.dss-tabs a[href="#OWS"]').tab("show")}var h=decodeURIComponent(n.getParamValue("title"))||"Layer",d=decodeURIComponent(n.getParamValue("abstract"));if(n.getParamValue("geojson_to_connect")){var f="geojson";(g=n.getParamValue("geojson_to_connect")).indexOf("gpx")>0&&(f="gpx"),g.indexOf("kml")>0&&(f="kml"),l(_=r.add(f,g,h,d,!1,"EPSG:4326"))}if(n.getParamValue("kml_to_connect")){var g=n.getParamValue("kml_to_connect"),_=r.add("kml",g,h,d,!0,"EPSG:4326");l(_)}e.$emit("scope_loaded","Ows")}]);window.allowWFS2&&e.requires.push("hs.ows.wfs")});