define(["angular","ol"],function(angular,ol){angular.module("hs.styles",["hs.map"]).service("hs.styles.service",["$http",function(e){this.pin_white_blue=new ol.style.Style({image:new ol.style.Icon({src:hsl_path+"img/pin_white_blue32.png",crossOrigin:"anonymous",anchor:[.5,1]})}),this.pin_white_blue_highlight=function(e,o){return[new ol.style.Style({image:new ol.style.Icon({src:e.get("highlighted")?hsl_path+"img/pin_white_red32.png":hsl_path+"img/pin_white_blue32.png",crossOrigin:"anonymous",anchor:[.5,1]})})]},this.measure_style=new ol.style.Style({fill:new ol.style.Fill({color:"rgbaa(255, 255, 255, 1)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})}),this.simple_style=new ol.style.Style({fill:new ol.style.Fill({color:"rgbaa(255, 255, 255, 1)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:1}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})})}]).directive("hs.styler.directive",function(){return{templateUrl:hsl_path+"components/styles/partials/styler.html?bust="+gitsha}}).directive("hs.styler.colorDirective",function(){return{scope:{color:"=info"},link:function(e,o,i){e.colors=[{"background-color":"rgba(244, 235, 55, 1)"},{"background-color":"rgba(205, 220, 57, 1)"},{"background-color":"rgba(98, 175, 68, 1)"},{"background-color":"rgba(0, 157, 87, 1)"},{"background-color":"rgba(11, 169, 204, 1)"},{"background-color":"rgba(65, 134, 240, 1)"},{"background-color":"rgba(63, 91, 169, 1)"},{"background-color":"rgba(124, 53, 146, 1)"},{"background-color":"rgba(166, 27, 74, 1)"},{"background-color":"rgba(219, 68, 54, 1)"},{"background-color":"rgba(248, 151, 27, 1)"},{"background-color":"rgba(244, 180, 0, 1)"},{"background-color":"rgba(121, 80, 70, 1)"},{"background-color":"rgba(249, 247, 166, 1)"},{"background-color":"rgba(230, 238, 163, 1)"},{"background-color":"rgba(183, 219, 171, 1)"},{"background-color":"rgba(124, 207, 169, 1)"},{"background-color":"rgba(147, 215, 232, 1)"},{"background-color":"rgba(159, 195, 255, 1)"},{"background-color":"rgba(167, 181, 215, 1)"},{"background-color":"rgba(198, 164, 207, 1)"},{"background-color":"rgba(214, 152, 173, 1)"},{"background-color":"rgba(238, 156, 150, 1)"},{"background-color":"rgba(250, 209, 153, 1)"},{"background-color":"rgba(255, 221, 94, 1)"},{"background-color":"rgba(178, 145, 137, 1)"},{"background-color":"rgba(255, 255, 255, 1)"},{"background-color":"rgba(204, 204, 204, 1)"},{"background-color":"rgba(119, 119, 119, 1)"},{"background-color":"rgba(0, 0, 0, 1)"}],e.colorSelected=function(o){e.color=o}},templateUrl:hsl_path+"components/styles/partials/color.html?bust="+gitsha}}).service("hs.styler.service",[function(){this.layer=null}]).controller("hs.styler.controller",["$scope","hs.styler.service","$sce","Core",function(e,o,i,l){function n(){var o=$(".hs-styler-selected-icon-box path");angular.isDefined(e.iconfillcolor)&&null!=e.iconfillcolor&&o.css("fill",e.iconfillcolor["background-color"]),angular.isDefined(e.iconlinecolor)&&null!=e.iconlinecolor&&o.css("stroke",e.iconlinecolor["background-color"]),angular.isDefined(e.iconlinewidth)&&null!=e.iconlinewidth&&o.css("stroke-width",e.iconlinewidth),e.serialized_icon="data:image/svg+xml;base64,"+window.btoa($(".hs-styler-selected-icon-box").html())}function r(){if(null!=o.layer){var i=o.layer.getSource();angular.isUndefined(o.layer)||null==o.layer||(angular.isUndefined(i.hasLine)&&c(i),e.hasLine=i.hasLine,e.hasPoly=i.hasPoly,e.hasPoint=i.hasPoint,e.layerTitle=o.layer.get("title"))}}function c(e){e.hasLine=!1,e.hasPoly=!1,e.hasPoint=!1,angular.forEach(e.getFeatures(),function(o){if(o.getGeometry())switch(o.getGeometry().getType()){case"LineString":e.hasLine=!0;break;case"Polygon":e.hasPoly=!0;break;case"Point":e.hasPoint=!0}})}e.service=o,e.icons=null,e.imagetypes=[{name:"none",hrname:"None"},{name:"icon",hrname:"Icon"},{name:"circle",hrname:"Circle"}],e.imagetype=e.imagetypes[0].name,e.radius=5,e.linewidth=2,e.iconlinewidth=2,e.save=function(){if(null!=o.layer){var i={};if(angular.isDefined(e.fillcolor)&&null!=e.fillcolor&&(i.fill=new ol.style.Fill({color:e.fillcolor["background-color"]})),angular.isDefined(e.linecolor)&&null!=e.linecolor&&e.linewidth>0&&(i.stroke=new ol.style.Stroke({color:e.linecolor["background-color"],width:angular.isDefined(e.linewidth)?parseFloat(e.linewidth):1})),"none"!=e.imagetype){if("circle"==e.imagetype&&(angular.isDefined(e.iconfillcolor)||angular.isDefined(e.iconlinecolor))){var l={radius:angular.isDefined(e.radius)?parseFloat(e.radius):5};angular.isDefined(e.iconfillcolor)&&null!=e.iconfillcolor&&(l.fill=new ol.style.Fill({color:e.iconfillcolor["background-color"]})),angular.isDefined(e.iconlinecolor)&&null!=e.iconlinecolor&&angular.isDefined(e.iconlinewidth)&&e.iconlinewidth>0&&(l.stroke=new ol.style.Stroke({color:e.iconlinecolor["background-color"],width:e.iconlinewidth,radius:angular.isDefined(e.radius)?parseFloat(e.radius):5})),i.image=new ol.style.Circle(l)}if("icon"==e.imagetype&&angular.isDefined(e.serialized_icon)){var n=new Image;n.src=e.serialized_icon,n.onload=function(){var e={img:n,imgSize:[n.width,n.height],anchor:[.6,.8],crossOrigin:"anonymous"};i.image=new ol.style.Icon(e),angular.forEach(o.layer.getSource().getFeatures(),function(e){e.setStyle(null)}),o.layer.setStyle(new ol.style.Style(i))}}}if(angular.isDefined(i.fill)||angular.isDefined(i.stroke)||angular.isDefined(i.image)){var r=new ol.style.Style(i);angular.forEach(o.layer.getSource().getFeatures(),function(e){e.setStyle(null)}),o.layer.setStyle(r)}}},e.iconSelected=function(o){$.ajax({url:e.hsl_path+"components/styles/img/svg/"+o,cache:!0,success:function(o){e.iconimage=i.trustAsHtml(o.documentElement.outerHTML),e.$$phase||e.$digest(),n(),e.save()}})},e.setImageType=function(o){e.imagetype=o,e.save()},e.$watch("linecolor",e.save),e.$watch("service.layer",r),e.$watch("fillcolor",e.save),e.$watch("iconfillcolor",function(){"icon"==e.imagetype&&n(),e.save()}),e.$watch("iconlinecolor",function(){"icon"==e.imagetype&&n(),e.save()}),e.$watch("iconlinewidth",function(){"icon"==e.imagetype&&n(),e.save()}),e.$watch("radius",function(){e.save()}),e.$on("core.mainpanel_changed",function(o,i){"styler"==l.mainpanel&&null==e.icons&&(e.icons=["bag1.svg","banking4.svg","bar.svg","beach17.svg","bicycles.svg","building103.svg","bus4.svg","cabinet9.svg","camping13.svg","caravan.svg","church15.svg","church1.svg","coffee-shop1.svg","disabled.svg","favourite28.svg","football1.svg","footprint.svg","gift-shop.svg","gps40.svg","gps41.svg","gps42.svg","gps43.svg","gps5.svg","hospital.svg","hot-air-balloon2.svg","information78.svg","library21.svg","location6.svg","luggage13.svg","monument1.svg","mountain42.svg","museum35.svg","park11.svg","parking28.svg","pharmacy17.svg","port2.svg","restaurant52.svg","road-sign1.svg","sailing-boat2.svg","ski1.svg","swimming26.svg","telephone119.svg","toilets2.svg","train-station.svg","university2.svg","warning.svg","wifi8.svg"]),r()}),e.$emit("scope_loaded","styler")}])});