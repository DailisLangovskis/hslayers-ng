define(["angular","core"],function(angular){angular.module("hs.mobile_settings",["hs.core"]).directive("hs.mobileSettings.directive",function(){return{templateUrl:hsl_path+"components/mobile_settings/partials/mobile_settings.html?bust="+gitsha}}).controller("hs.mobile_settings.controller",["$scope","config","Core","hs.map.service","$window",function(e,t,o,s,n){e.Core=o,configDebug=t,e.settingsDb=settingsDb,e.originalHostnames=$.extend({},t.hostname),e.hostnames=t.hostnames,t.hostname.default=t.hostnames[0],e.selectedHostname=t.hostnames[0].title,e.addHostname=function(){e.userHostname&&(t.hostname.user={title:"User hostname",type:"user",editable:!0,url:e.userHostname},settingsDb.transaction(function(o){o.executeSql("REPLACE INTO Hostnames VALUES (?,?,?,?)",[t.hostname.user.title,t.hostname.user.type,t.hostname.user.editable,t.hostname.user.url],function(t,o){e.userHostname="",console.log(o.insertId)})}))},e.changeHostname=function(){console.log(this,e.hostname),angular.forEach(e.hostnames,function(o){e.selectedHostname==o.title&&(t.hostname[o.type]=o)})},e.deleteHostname=function(){delete e.hostname[this.hostname.type],e.deleteRow(settingsDb,this.hostname.type)},e.preFill=function(){e.userHostname=e.userHostname?e.userHostname:"http://"},e.removePreFill=function(){e.userHostname="http://"==e.userHostname?"":e.userHostname},e.initSettings=function(o){console&&(console.log("Populating hostnames database."),console.log(e.hostname),console.log(t.hostname),console.log(settingsDb)),e.hostname=t.hostname,o.transaction(function(t){t.executeSql("DROP TABLE IF EXISTS Hostnames",[],console.log("Dropping hostnames table.")),t.executeSql("CREATE TABLE IF NOT EXISTS Hostnames (title unique, type, editable, url)",[],console.log("Creating hostnames table.")),$.each(e.hostname,function(e,o){t.executeSql("INSERT INTO Hostnames VALUES (?,?,?,?)",[o.title,o.type,o.editable,o.url])})},function(){})},e.loadSettingsFromDb=function(e){dbHostnames={},e.executeSql("SELECT * FROM Hostnames",[],function(e,t){for(var o=0;o<t.rows.length;o++)dbHostnames[t.rows.item(o).type]={title:t.rows.item(o).title,type:t.rows.item(o).type,editable:JSON.parse(t.rows.item(o).editable),url:t.rows.item(o).url}})},e.deleteRow=function(e,t){e.transaction(function(e){e.executeSql("DELETE FROM Hostnames WHERE type = ?",[t])})},settingsDb.transaction(e.loadSettingsFromDb,function(t){console.log(t),e.initSettings(settingsDb),console.log("Loading initial settings.")},function(){Object.keys(dbHostnames)[0]&&(t.hostname=dbHostnames,e.hostname=t.hostname,console.log("Loading settings from memory."))}),e.$on("scope_loaded",function(){$("#loading-logo").remove()}),e.$emit("scope_loaded","Mobile Settings")}])});