define(["angular","map","core","updateMeta","permalink"],function(angular){angular.module("hs.info",["hs.map","hs.core","updateMeta"]).directive("hs.info.directive",function(){return{templateUrl:hsl_path+"components/info/partials/info.html?bust="+gitsha}}).controller("hs.info.controller",["$rootScope","$scope","$timeout","Core",function(o,i,t,e){i.Core=e,i.composition_loaded=!0,i.layer_loading=[],i.$on("compositions.composition_loading",function(o,t){angular.isUndefined(t.error)&&(angular.isDefined(t.data)?(i.composition_abstract=t.data.abstract,i.composition_title=t.data.title,i.composition_id=t.data.id):(i.composition_abstract=t.abstract,i.composition_title=t.title,i.composition_id=t.id),i.composition_loaded=!1,i.info_image="icon-map"),i.$$phase||i.$digest()}),i.$on("compositions.composition_loaded",function(o,e){if(angular.isDefined(e.error)){var n=i.composition_abstract,a=i.composition_title;i.composition_abstract=e.abstract,i.composition_title=e.title,i.info_image="glyphicon-warning-sign",t(function(){i.composition_title=a,i.composition_abstract=n,i.info_image="icon-map",i.$$phase||i.$digest()},3e3)}i.composition_loaded=!0,i.composition_edited=!1,i.$$phase||i.$digest()}),i.$on("layermanager.layer_loading",function(o,t){t.get("title")in i.layer_loading||i.layer_loading.push(t.get("title")),i.composition_loaded=!1,i.$$phase||i.$digest()}),i.$on("layermanager.layer_loaded",function(o,t){for(var e=0;e<i.layer_loading.length;e++)i.layer_loading[e]==t.get("title")&&i.layer_loading.splice(e,1);0==i.layer_loading.length&&(i.composition_loaded=!0),i.$$phase||i.$digest()}),i.$on("compositions.composition_deleted",function(o,t){t==i.composition_id&&(delete i.composition_title,delete i.composition_abstract,i.$$phase||i.$digest())}),i.$on("core.map_reset",function(o){delete i.composition_title,delete i.composition_abstract,i.layer_loading.length=0,i.composition_loaded=!0,i.composition_edited=!1,i.$$phase||i.$digest()}),i.compositionLoaded=function(){return angular.isDefined(i.composition_title)},o.$on("compositions.composition_edited",function(o){i.composition_edited=!0}),i.$emit("scope_loaded","info")}])});