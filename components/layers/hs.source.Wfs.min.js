define(["ol"],function(ol){return function(e){void 0===e.version&&(e.version="1.0.0"),void 0===e.hsproxy&&(e.hsproxy=!0),void 0===e.format&&(e.format=new ol.format.GeoJSON),e.projection=e.projection.toUpperCase(),void 0===e.parser&&(e.parser=function(e){var t=[],o=new ol.format.GML3;for(var r in o)r.indexOf("_PARSERS")>0&&(o[r]["http://www.opengis.net/gml/3.2"]=o[r]["http://www.opengis.net/gml"]);return $("member",e).each(function(){var e={},r=$("geometry",this).get(0)||$("CP\\:geometry",this).get(0);e.geometry=o.readGeometryElement(r,[{}]);var i=new ol.Feature(e);t.push(i)}),t});var t=new ol.source.Vector({format:e.format,loader:function(t,o,r){this.set("loaded",!1),this.clear(),console&&console.log("resolution",o);var i=e.url+(e.url.indexOf("?")>0?"&":"?")+"service=WFS&TYPENAME="+e.typename+"&request=GetFeature&version="+e.version+"&SRSNAME="+e.projection+"&outputFormat=geojson&bbox="+t.join(",")+",urn:ogc:def:crs:EPSG:6.3:3857",n=e.hsproxy?"/cgi-bin/hsproxy.cgi?toEncoding=utf-8&url="+window.escape(i):i;$.ajax({url:n,context:this}).done(function(t){this.addFeatures(e.parser(t)),this.hasLine=!1,this.hasPoly=!1,this.hasPoint=!1,angular.forEach(this.getFeatures(),function(e){if(e.getGeometry())switch(e.getGeometry().getType()){case"LineString":this.hasLine=!0;break;case"Polygon":this.hasPoly=!0;break;case"Point":this.hasPoint=!0}}),(this.hasLine||this.hasPoly||this.hasPoint)&&(this.styleAble=!0),this.set("loaded",!0)})},projection:e.projection,strategy:ol.loadingstrategy.bbox});return t.defOptions=e,t}});