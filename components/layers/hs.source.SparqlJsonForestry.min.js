define(["ol"],function(ol){return function(e){var o={},r=new ol.source.Vector({format:new ol.format.GeoJSON,loader:function(a,t,n){if(void 0!==r.options.clear_on_move&&r.options.clear_on_move&&r.clear(),void 0===e.hsproxy&&(e.hsproxy=!1),""!=r.options.url){var l=r.options.url;e.hsproxy&&(l="/cgi-bin/hsproxy.cgi?toEncoding=utf-8&url="+encodeURIComponent(l)),$.ajax({url:l}).done(function(a){for(var t={},n=Number.MAX_VALUE,l=Number.MIN_VALUE,u=0;u<a.results.bindings.length;u++){var s=a.results.bindings[u];void 0===t[s.o.value]&&(t[s.o.value]={}),s.s.datatype&&"http://www.w3.org/2001/XMLSchema#double"==s.s.datatype?t[s.o.value][s.p.value]=parseFloat(s.s.value).toFixed(2):t[s.o.value][s.p.value]=s.s.value,s.p.value==e.value_attr&&(n>parseFloat(s.s.value)&&(n=parseFloat(t[s.o.value][s.p.value])),l<parseFloat(s.s.value)&&(l=parseFloat(t[s.o.value][s.p.value])))}for(var i=[],u=0,v=function(e,o,r){return"rgba("+["228, 251, 203","198, 229, 171","168, 208, 140","139, 187, 109","109, 165, 77","79, 144, 46","50, 123, 15","44, 110, 13"][o]+", 0.7)"},p=(l-n)/7,d=0;d<=7;d++){var c=parseFloat(n+d*p),g=parseFloat(n+(d+1)*p);o[d]={name:c.toFixed(2)+" - "+g.toFixed(2),color:v(0,d)}}for(var m in t)if(u++,t[m][e.geometry_attr]){var f=(new ol.format.WKT).readFeature(t[m][e.geometry_attr]);t[m].geometry=f.getGeometry(),t[m].geometry.transform("EPSG:4326",e.projection),delete t[m][e.geometry_attr];var y=new ol.Feature(t[m]);y.color=v(0,parseInt((t[m][e.value_attr]-n)/((l-n)/7))),i.push(y)}r.addFeatures(i)})}},strategy:ol.loadingstrategy.all,projection:e.projection});return r.options=e,r.legend_categories=o,r}});